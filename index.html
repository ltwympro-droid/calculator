<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --bg:#f2f4f8;
 --card:#ffffff;
 --text:#1a1a1a;
 --accent:#0a84ff;
 --soft:#eef3ff;
}
body.dark{
 --bg:#0f1720;
 --card:#18222d;
 --text:#e6edf3;
 --accent:#3aa0ff;
 --soft:#1e2b3a;
}
body{
 font-family:Arial;
 background:var(--bg);
 color:var(--text);
 margin:0;
 padding:20px;
}
.card{
 max-width:760px;
 margin:auto;
 background:var(--card);
 padding:24px;
 border-radius:14px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.block{margin-top:16px}
label{
 font-weight:bold;
 display:flex;
 justify-content:space-between;
}
input,select{
 width:100%;
 padding:8px;
 margin-top:6px;
}
input[type=range]{padding:0}
.result{
 margin-top:22px;
 background:var(--soft);
 padding:16px;
 border-radius:10px;
 font-size:15px;
}
.ok{color:#0a7a2f;font-weight:bold}
.bad{color:#c40000;font-weight:bold}
button{
 padding:10px 14px;
 border:none;
 border-radius:8px;
 background:var(--accent);
 color:white;
 cursor:pointer;
 margin:4px 4px 0 0;
}
.admin{
 background:#fff4e5;
 padding:14px;
 border-radius:10px;
 margin-top:20px;
 display:none;
}
@media print{
 button,.admin{display:none}
}
</style>
</head>

<body>

<div class="card">

<h2>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>

<button onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
<button onclick="loadRate()">–ö—É—Ä—Å –ù–ë–£</button>
<button onclick="toggleAdmin()">–ê–¥–º—ñ–Ω</button>
<button onclick="window.print()">PDF</button>

<div id="rateBox"></div>

<div class="block">
<label>–ó–∞–≥–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∏ (–≥—Ä–Ω) <span id="priceVal"></span></label>
<input type="range" id="price" min="500000" max="10000000" step="50000" value="3900000">
</div>

<div class="block">
<label>–ü–ª–æ—â–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∏ –º¬≤ <span id="areaVal"></span></label>
<input type="range" id="area" min="20" max="150" value="60">
</div>

<div class="block">
<label>–°–∫–ª–∞–¥ —Å—ñ–º º—ó <span id="famVal"></span></label>
<input type="range" id="fam" min="1" max="6" value="2">
</div>

<div class="block">
<label>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ % <span id="downVal"></span></label>
<input type="range" id="down" min="10" max="80" value="25">
</div>

<div class="block">
<label>–õ—ñ–º—ñ—Ç –∫—Ä–µ–¥–∏—Ç—É –±–∞–Ω–∫—É (–≥—Ä–Ω)</label>
<input type="number" id="bankCap" value="3000000">
</div>

<div class="block">
<label>–°—Ç–∞–≤–∫–∞</label>
<select id="rateSel">
<option value="3">3%</option>
<option value="7">7%</option>
</select>
</div>

<div class="block">
<label>–¢–µ—Ä–º—ñ–Ω —Ä–æ–∫—ñ–≤ <span id="yearsVal"></span></label>
<input type="range" id="years" min="5" max="30" value="20">
</div>

<!-- ADMIN -->

<div class="admin" id="adminBox">
<h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏</h3>

<label>–ë–∞–∑–∞ –º¬≤</label>
<input id="baseM2" type="number" value="30081">

<label>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç</label>
<input id="coef" type="number" value="2">

<label>–î–æ–ø—É—Å–∫ %</label>
<input id="extraPct" type="number" value="10">

<label>–ú—ñ–Ω –≤–Ω–µ—Å–æ–∫ %</label>
<input id="minDown" type="number" value="20">

<button onclick="calc()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
</div>

<div class="result" id="out"></div>

</div>

<script>
const PIN="1357";
let usd=38;

const $ = id => document.getElementById(id);
const fmt = n => Number(n).toLocaleString("uk-UA");

function toggleTheme(){
 document.body.classList.toggle("dark");
}

function toggleAdmin(){
 const box = $("adminBox");
 if(box.style.display==="block"){
   box.style.display="none";
 } else {
   if(prompt("PIN")==PIN){
     box.style.display="block";
   }
 }
}

async function loadRate(){
 try{
  const r = await fetch("https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json");
  const j = await r.json();
  usd = j[0].rate;
  $("rateBox").innerHTML="USD –ù–ë–£: "+usd.toFixed(2);
  calc();
 }catch{}
}

[
"price","area","fam","down","years","rateSel",
"baseM2","coef","extraPct","minDown","bankCap"
].forEach(id => {
 $(id).addEventListener("input", calc);
 $(id).addEventListener("change", calc);
});

function calc(){

 const price = +$("price").value;
 const area = +$("area").value;
 const fam = +$("fam").value;
 const downP = +$("down").value;
 const years = +$("years").value;
 const rate = +$("rateSel").value;
 const cap = +$("bankCap").value;

 const base = +$("baseM2").value;
 const coef = +$("coef").value;
 const extra = +$("extraPct").value/100;
 const minDown = +$("minDown").value;

 const normArea = fam<=2 ? 52.5 : 52.5+(fam-2)*21;
 const maxArea = Math.min(normArea*(1+extra),115.5);

 const limitM2 = base*coef*(1+extra);
 const maxPrice = limitM2*normArea;

 const downSum = price*downP/100;
 const loan = price-downSum;

 const mr = rate/100/12;
 const months = years*12;
 const pay = loan*(mr*Math.pow(1+mr,months))/
             (Math.pow(1+mr,months)-1);

 const fit =
  price<=maxPrice &&
  area<=maxArea &&
  downP>=minDown &&
  loan<=cap;

 $("priceVal").innerHTML=fmt(price);
 $("areaVal").innerHTML=area+" –º¬≤";
 $("famVal").innerHTML=fam;
 $("downVal").innerHTML=downP+"%";
 $("yearsVal").innerHTML=years+" —Ä–æ–∫—ñ–≤";

 $("out").innerHTML=`
 ${fit?'<div class="ok">‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—ñ–¥ —î–û—Å–µ–ª—è</div>':'<div class="bad">‚ùå –ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å</div>'}
 <hr>
 –¶—ñ–Ω–∞: ${fmt(price)} –≥—Ä–Ω (~$${fmt((price/usd).toFixed(0))})<br>
 –í–Ω–µ—Å–æ–∫: ${fmt(downSum)} –≥—Ä–Ω<br>
 –ö—Ä–µ–¥–∏—Ç: ${fmt(loan)} –≥—Ä–Ω<br>
 –©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂: <b>${fmt(pay.toFixed(0))} –≥—Ä–Ω</b><br>
 <hr>
 –ù–æ—Ä–º–∞—Ç–∏–≤ –ø–ª–æ—â—ñ: ${normArea.toFixed(1)} –º¬≤<br>
 –ú–∞–∫—Å –¥–æ–ø—É—Å—Ç–∏–º–∞ –ø–ª–æ—â–∞: ${maxArea.toFixed(1)} –º¬≤<br>
 –ú–∞–∫—Å –¥–æ–ø—É—Å—Ç–∏–º–∞ —Ü—ñ–Ω–∞: ${fmt(maxPrice.toFixed(0))} –≥—Ä–Ω<br>
 –õ—ñ–º—ñ—Ç –∫—Ä–µ–¥–∏—Ç—É –±–∞–Ω–∫—É: ${fmt(cap)} –≥—Ä–Ω
 `;
}

calc();
</script>

</body>
</html>
