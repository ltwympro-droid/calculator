<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --bg:#f2f4f8;
 --card:#ffffff;
 --text:#1a1a1a;
 --accent:#0a84ff;
 --soft:#eef3ff;
}

body.dark{
 --bg:#0f1720;
 --card:#18222d;
 --text:#e6edf3;
 --accent:#3aa0ff;
 --soft:#1e2b3a;
}

body{
 font-family:Arial;
 background:var(--bg);
 color:var(--text);
 margin:0;
 padding:20px;
 transition:.25s;
}

.card{
 max-width:820px;
 margin:auto;
 background:var(--card);
 padding:24px;
 border-radius:14px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.block{margin-top:18px}
label{font-weight:bold;display:flex;justify-content:space-between}
input,select{width:100%;padding:8px;margin-top:6px}
input[type=range]{padding:0}

.result{
 margin-top:22px;
 background:var(--soft);
 padding:16px;
 border-radius:10px;
}

.ok{color:#0a7a2f;font-weight:bold}
.bad{color:#c40000;font-weight:bold}

button{
 padding:10px 14px;
 border:none;
 border-radius:8px;
 background:var(--accent);
 color:white;
 cursor:pointer;
 margin:4px 4px 0 0;
}

.admin{
 background:#fff4e5;
 padding:14px;
 border-radius:10px;
 margin-top:20px;
 display:none;
}

@media print{
 button,.admin{display:none}
 body{background:white}
}
</style>
</head>

<body>

<div class="card">

<h2>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>

<button onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
<button onclick="loadRate()">–ö—É—Ä—Å –ù–ë–£</button>
<button onclick="adminLogin()">–ê–¥–º—ñ–Ω</button>
<button onclick="window.print()">PDF</button>

<div id="rateBox"></div>

<!-- CLIENT INPUT -->

<div class="block">
<label>–°–∫–ª–∞–¥ —Å—ñ–º º—ó <span id="famVal"></span></label>
<input type="range" id="fam" min="1" max="6" value="2">
</div>

<div class="block">
<label>–ü–ª–æ—â–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∏ –º¬≤ <span id="areaVal"></span></label>
<input type="range" id="area" min="20" max="150" value="60">
</div>

<div class="block">
<label>–¶—ñ–Ω–∞ –∑–∞ –º¬≤ <span id="m2Val"></span></label>
<input type="range" id="m2" min="25000" max="120000" step="1000" value="65000">
</div>

<div class="block">
<label>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ % <span id="downVal"></span></label>
<input type="range" id="down" min="10" max="80" value="25">
</div>

<div class="block">
<label>–°—Ç–∞–≤–∫–∞</label>
<select id="rate">
<option value="3">3%</option>
<option value="7">7%</option>
</select>
</div>

<div class="block">
<label>–¢–µ—Ä–º—ñ–Ω —Ä–æ–∫—ñ–≤ <span id="yearsVal"></span></label>
<input type="range" id="years" min="5" max="30" value="20">
</div>

<!-- APPRAISAL -->

<h3>–û—Ü—ñ–Ω–∫–∞ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏ —É–≥–æ–¥–∏</h3>

<label>–û—Ü—ñ–Ω–æ—á–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)</label>
<input id="appraisal" type="number" value="4000000">

<label>–í–∞—Ä—Ç—ñ—Å—Ç—å –æ—Ü—ñ–Ω–∫–∏</label>
<input id="appraisalCost" type="number" value="6000">

<label>
<input type="checkbox" id="pf" checked>
–ü–µ–Ω—Å—ñ–π–Ω–∏–π —Ñ–æ–Ω–¥ 1%
</label>

<!-- ADMIN -->

<div class="admin" id="adminBox">
<h3>–ê–¥–º—ñ–Ω –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>

–ë–∞–∑–∞ –º¬≤ (–ö–∏—ó–≤)
<input id="base" type="number" value="30081">

–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç
<input id="coef" type="number" value="2">

–î–æ–ø—É—Å–∫ %
<input id="extra" type="number" value="10">

–ú—ñ–Ω –≤–Ω–µ—Å–æ–∫ %
<input id="minDown" type="number" value="20">

–õ—ñ–º—ñ—Ç –∫—Ä–µ–¥–∏—Ç—É –±–∞–Ω–∫—É
<input id="cap" type="number" value="3000000">
</div>

<div class="result" id="out"></div>

</div>

<script>
const PIN="1357";
let usd=38;

function toggleTheme(){
 document.body.classList.toggle("dark");
}

function adminLogin(){
 if(prompt("PIN")==PIN){
  document.getElementById("adminBox").style.display="block";
 }
}

async function loadRate(){
 try{
  let r=await fetch("https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json");
  let j=await r.json();
  usd=j[0].rate;
  rateBox.innerHTML="USD –ù–ë–£: "+usd.toFixed(2);
  calc();
 }catch{}
}

const ids=["fam","area","m2","down","rate","years",
"appraisal","appraisalCost","pf",
"base","coef","extra","minDown","cap"];

ids.forEach(x=>document.getElementById(x).oninput=calc);

const id=x=>document.getElementById(x);
const fmt=n=>Number(n).toLocaleString("uk-UA");

function normArea(f){
 return f<=2?52.5:52.5+(f-2)*21;
}

function calc(){

 let fam=+id("fam").value;
 let area=+id("area").value;
 let m2=+id("m2").value;
 let downP=+id("down").value;
 let years=+id("years").value;
 let rate=+id("rate").value;

 let base=+id("base").value;
 let coef=+id("coef").value;
 let extra=+id("extra").value/100;
 let minDown=+id("minDown").value;
 let cap=+id("cap").value;

 let norm=normArea(fam);
 let maxArea=Math.min(norm*(1+extra),115.5);
 let limitM2=base*coef*(1+extra);
 let maxPrice=limitM2*norm;

 let price=area*m2;
 let downSum=price*downP/100;
 let loan=price-downSum;

 let mr=rate/100/12;
 let pay = loan*(mr*Math.pow(1+mr,years*12))/
          (Math.pow(1+mr,years*12)-1);

 // EXTRA COSTS

 let appr=+id("appraisal").value || price;
 let appraisalCost=+id("appraisalCost").value;

 let bankFee=loan*0.01;
 let insurance=appr*0.0025;
 let pf=id("pf").checked ? appr*0.01 : 0;

 let creditContract=20000;
 let saleContract=20000;

 let extraTotal =
 appraisalCost +
 bankFee +
 insurance +
 pf +
 creditContract +
 saleContract;

 let cashNeeded = downSum + extraTotal;

 // CHECKS

 let fit = area<=maxArea &&
           m2<=limitM2 &&
           price<=maxPrice &&
           downP>=minDown &&
           loan<=cap;

 // UI VALUES

 famVal.innerHTML=fam;
 areaVal.innerHTML=area+" –º¬≤";
 m2Val.innerHTML=fmt(m2);
 downVal.innerHTML=downP+"%";
 yearsVal.innerHTML=years+" —Ä–æ–∫—ñ–≤";

 out.innerHTML=`
 ${fit?'<div class="ok">‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—ñ–¥ —î–û—Å–µ–ª—è</div>':'<div class="bad">‚ùå –ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å</div>'}
 <hr>

 –¶—ñ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∏: <b>${fmt(price)}</b> –≥—Ä–Ω (~$${fmt((price/usd).toFixed(0))})<br>
 –ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫: ${fmt(downSum)} –≥—Ä–Ω<br>
 –ö—Ä–µ–¥–∏—Ç: ${fmt(loan)} –≥—Ä–Ω<br>
 –ü–ª–∞—Ç—ñ–∂ ‚âà ${fmt(pay.toFixed(0))} –≥—Ä–Ω<br>

 <hr>
 <b>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏:</b><br>
 –û—Ü—ñ–Ω–∫–∞: ${fmt(appraisalCost)}<br>
 –ë–∞–Ω–∫ 1%: ${fmt(bankFee.toFixed(0))}<br>
 –°—Ç—Ä–∞—Ö—É–≤–∞–Ω–Ω—è 0.25%: ${fmt(insurance.toFixed(0))}<br>
 –ü–µ–Ω—Å—ñ–π–Ω–∏–π —Ñ–æ–Ω–¥: ${fmt(pf.toFixed(0))}<br>
 –ö—Ä–µ–¥–∏—Ç–Ω–∏–π –¥–æ–≥–æ–≤—ñ—Ä: 20 000<br>
 –î–ö–ü: 20 000<br>

 <b>–†–∞–∑–æ–º –≤–∏—Ç—Ä–∞—Ç–∏:</b> ${fmt(extraTotal.toFixed(0))}<br>
 <b>–ü–æ–≤–Ω–∏–π –±—é–¥–∂–µ—Ç –≤—Ö–æ–¥—É:</b> ${fmt(cashNeeded.toFixed(0))}<br>

 <hr>
 –õ—ñ–º—ñ—Ç –º¬≤: ${fmt(limitM2)}<br>
 –ú–∞–∫—Å –ø–ª–æ—â–∞: ${maxArea.toFixed(1)} –º¬≤<br>
 –ú–∞–∫—Å —Ü—ñ–Ω–∞: ${fmt(maxPrice.toFixed(0))}
 `;
}

calc();
</script>

</body>
</html>
