<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --bg:#f2f4f8;
 --card:#ffffff;
 --text:#1a1a1a;
 --accent:#0a84ff;
 --soft:#eef3ff;
}
body.dark{
 --bg:#0f1720;
 --card:#18222d;
 --text:#e6edf3;
 --accent:#3aa0ff;
 --soft:#1e2b3a;
}
body{
 font-family:Arial;
 background:var(--bg);
 color:var(--text);
 margin:0;
 padding:20px;
}
.card{
 max-width:860px;
 margin:auto;
 background:var(--card);
 padding:24px;
 border-radius:14px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.block{margin-top:18px}
label{font-weight:bold}
input,select{width:100%;padding:8px;margin-top:6px}
input[type=range]{padding:0}
.result{
 margin-top:22px;
 background:var(--soft);
 padding:16px;
 border-radius:10px;
}
.ok{color:#0a7a2f;font-weight:bold}
.bad{color:#c40000;font-weight:bold}
.row{
 display:grid;
 grid-template-columns: 24px 1fr 90px;
 gap:10px;
 align-items:center;
 margin-top:8px;
}
button{
 padding:10px 14px;
 border:none;
 border-radius:8px;
 background:var(--accent);
 color:white;
 cursor:pointer;
 margin:4px 4px 0 0;
}
.admin{
 background:#fff4e5;
 padding:14px;
 border-radius:10px;
 margin-top:20px;
 display:none;
}
@media print{
 button,.admin{display:none}
}
</style>
</head>

<body>
<div class="card">

<h2>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>

<button onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
<button onclick="loadRate()">–ö—É—Ä—Å –ù–ë–£</button>
<button onclick="adminLogin()">–ê–¥–º—ñ–Ω</button>
<button onclick="window.print()">PDF</button>

<div id="rateBox"></div>

<!-- MAIN -->

<label>–°–∫–ª–∞–¥ —Å—ñ–º º—ó</label>
<input type="range" id="fam" min="1" max="6" value="2">

<label>–ü–ª–æ—â–∞ –º¬≤</label>
<input type="range" id="area" min="20" max="150" value="60">

<label>–¶—ñ–Ω–∞ –∑–∞ –º¬≤</label>
<input type="range" id="m2" min="25000" max="120000" step="1000" value="65000">

<label>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ %</label>
<input type="range" id="down" min="10" max="80" value="25">

<select id="rate">
<option value="3">3%</option>
<option value="7">7%</option>
</select>

<label>–¢–µ—Ä–º—ñ–Ω —Ä–æ–∫—ñ–≤</label>
<input type="range" id="years" min="5" max="30" value="20">

<!-- APPRAISAL -->

<h3>–û—Ü—ñ–Ω–∫–∞</h3>
<input id="appraisal" type="number" value="4000000">
<input id="appraisalCost" type="number" value="6000">

<!-- TAX COLUMN -->

<h3>–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∫–æ–º—ñ—Å—ñ—ó</h3>

<div class="row">
<input type="checkbox" id="pf" checked>
<div>–ü–µ–Ω—Å—ñ–π–Ω–∏–π —Ñ–æ–Ω–¥</div>
<input id="pfPct" value="1">
</div>

<div class="row">
<input type="checkbox" id="duty" checked>
<div>–î–µ—Ä–∂–º–∏—Ç–æ</div>
<input id="dutyPct" value="1">
</div>

<div class="row">
<input type="checkbox" id="agency">
<div>–ü–æ—Å–ª—É–≥–∏ –∞–≥–µ–Ω—Ü—ñ—ó</div>
<input id="agencyPct" value="5">
</div>

<div class="row">
<input type="checkbox" id="war">
<div>–í—ñ–π—Å—å–∫–æ–≤–∏–π –∑–±—ñ—Ä</div>
<input id="warPct" value="5">
</div>

<div class="row">
<input type="checkbox" id="income">
<div>–ü–î–§–û</div>
<input id="incomePct" value="5">
</div>

<!-- ADMIN -->

<div class="admin" id="adminBox">
–ë–∞–∑–∞ –º¬≤ <input id="base" value="30081">
–ö–æ–µ—Ñ <input id="coef" value="2">
–î–æ–ø—É—Å–∫ % <input id="extra" value="10">
–ú—ñ–Ω –≤–Ω–µ—Å–æ–∫ <input id="minDown" value="20">
–õ—ñ–º—ñ—Ç –∫—Ä–µ–¥–∏—Ç—É <input id="cap" value="3000000">
</div>

<div class="result" id="out"></div>

</div>

<script>
const PIN="1357";
let usd=38;

function toggleTheme(){document.body.classList.toggle("dark");}
function adminLogin(){if(prompt("PIN")==PIN) adminBox.style.display="block";}

async function loadRate(){
 let r=await fetch("https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json");
 let j=await r.json();
 usd=j[0].rate;
 rateBox.innerHTML="USD: "+usd.toFixed(2);
 calc();
}

document.querySelectorAll("input,select").forEach(e=>e.oninput=calc);

const fmt=n=>Number(n).toLocaleString("uk-UA");

function pctCost(flag,pct,base){
 return flag.checked ? base*(pct.value/100) : 0;
}

function calc(){

 let fam=famVal=+fam.value;
 let norm=fam<=2?52.5:52.5+(fam-2)*21;

 let areaN=+area.value;
 let m2N=+m2.value;
 let price=areaN*m2N;

 let downP=+down.value;
 let downSum=price*downP/100;
 let loan=price-downSum;

 let appr=+appraisal.value || price;

 let bankFee=loan*0.01;
 let insurance=appr*0.0025;

 let taxTotal =
 pctCost(pf,pfPct,appr)+
 pctCost(duty,dutyPct,appr)+
 pctCost(agency,agencyPct,appr)+
 pctCost(war,warPct,appr)+
 pctCost(income,incomePct,appr);

 let extra =
 +appraisalCost.value +
 bankFee +
 insurance +
 taxTotal +
 20000 + 20000;

 out.innerHTML = `
–¶—ñ–Ω–∞: ${fmt(price)} –≥—Ä–Ω<br>
–í–Ω–µ—Å–æ–∫: ${fmt(downSum)}<br>
–ö—Ä–µ–¥–∏—Ç: ${fmt(loan)}<br>
<hr>
–ü–æ–¥–∞—Ç–∫–∏/–∫–æ–º—ñ—Å—ñ—ó: ${fmt(taxTotal.toFixed(0))}<br>
–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏: ${fmt(extra.toFixed(0))}<br>
<b>–ü–æ–≤–Ω–∏–π –±—é–¥–∂–µ—Ç: ${fmt((downSum+extra).toFixed(0))}</b>
`;
}

calc();
</script>

</body>
</html>
