<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --bg:#f4f6f9;
 --card:#ffffff;
 --text:#1b1f24;
 --accent:#2563eb;
 --accent-soft:#eaf1ff;
 --danger:#dc2626;
 --success:#16a34a;
 --border:#e5e7eb;
}
body.dark{
 --bg:#0f172a;
 --card:#1e293b;
 --text:#f1f5f9;
 --accent:#3b82f6;
 --accent-soft:#1e3a8a;
 --border:#334155;
}
body{
 font-family:-apple-system,BlinkMacSystemFont,sans-serif;
 background:var(--bg);
 color:var(--text);
 margin:0;
 padding:24px;
}
.container{max-width:1000px;margin:auto;}
.card{
 background:var(--card);
 border-radius:16px;
 padding:24px;
 border:1px solid var(--border);
 box-shadow:0 10px 25px rgba(0,0,0,.05);
}
.grid{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:20px;
}
@media(max-width:768px){
 .grid{grid-template-columns:1fr;}
}
.field{margin-bottom:18px;}
label{
 font-weight:600;
 display:flex;
 justify-content:space-between;
 margin-bottom:6px;
 font-size:14px;
}
input,select{
 width:100%;
 padding:10px;
 border-radius:8px;
 border:1px solid var(--border);
 font-size:14px;
 background:transparent;
 color:var(--text);
}
input[type=range]{padding:0;}
.result{
 margin-top:24px;
 padding:20px;
 border-radius:12px;
 background:var(--accent-soft);
}
.status{
 font-weight:700;
 font-size:16px;
 margin-bottom:10px;
}
.success{color:var(--success);}
.error{color:var(--danger);}
button{
 padding:10px 16px;
 border:none;
 border-radius:10px;
 background:var(--accent);
 color:white;
 font-weight:600;
 cursor:pointer;
 margin-right:8px;
 margin-bottom:10px;
}
.admin{
 margin-top:20px;
 padding:20px;
 border-radius:12px;
 background:#fff7ed;
 display:none;
}
body.dark .admin{
 background:#3f2d16;
}
</style>
</head>

<body>

<div class="container">
<div class="card">

<h2>—î–û—Å–µ–ª—è / USL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>

<button onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
<button onclick="updateRate()">–û–Ω–æ–≤–∏—Ç–∏ –∫—É—Ä—Å –ù–ë–£</button>
<button onclick="toggleAdmin()">–ê–¥–º—ñ–Ω</button>
<button onclick="window.print()">PDF</button>

<div id="rateBox">USD: 38.00</div>

<div class="grid">

<div>
<div class="field">
<label>–ó–∞–≥–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ (–≥—Ä–Ω) <span id="priceVal"></span></label>
<input type="range" id="price" min="500000" max="7000000" step="50000" value="4000000">
</div>

<div class="field">
<label>–ü–ª–æ—â–∞ (–º¬≤) <span id="areaVal"></span></label>
<input type="range" id="area" min="20" max="150" value="60">
</div>

<div class="field">
<label>–°–∫–ª–∞–¥ —Å—ñ–º º—ó <span id="famVal"></span></label>
<input type="range" id="fam" min="1" max="6" value="2">
</div>
</div>

<div>
<div class="field">
<label>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ % <span id="downVal"></span></label>
<input type="range" id="down" min="10" max="80" value="25">
</div>

<div class="field">
<label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏–¥–∞—á–∞ –±–∞–Ω–∫—É (–≥—Ä–Ω) <span id="capVal"></span></label>
<input type="range" id="bankCap" min="1000000" max="7000000" step="100000" value="5000000">
</div>

<div class="field">
<label>–°—Ç–∞–≤–∫–∞</label>
<select id="rateSel">
<option value="3">3%</option>
<option value="7">7%</option>
</select>
</div>

<div class="field">
<label>–¢–µ—Ä–º—ñ–Ω (—Ä–æ–∫—ñ–≤) <span id="yearsVal"></span></label>
<input type="range" id="years" min="5" max="30" value="20">
</div>
</div>

</div>

<div class="admin" id="adminBox">
<h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏</h3>

<label>–ë–∞–∑–æ–≤–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –º¬≤</label>
<input type="number" id="baseM2" value="30081">

<label>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç</label>
<input type="number" id="coef" value="2">

<label>–î–æ–ø—É—Å–∫ %</label>
<input type="number" id="extraPct" value="10">

<label>–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤–Ω–µ—Å–æ–∫ (%)</label>
<input type="number" id="minDown" value="20">

<label>–õ—ñ–º—ñ—Ç –ø—Ä–æ–≥—Ä–∞–º–∏ (–≥—Ä–Ω)</label>
<input type="number" id="programLimit" value="5000000">

<button onclick="calc()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
</div>

<div class="result" id="out"></div>

</div>
</div>

<script>
const PIN="1357";
let usd=38;

const $=id=>document.getElementById(id);
const fmt=n=>Number(n).toLocaleString("uk-UA");

function toggleTheme(){document.body.classList.toggle("dark");}

function toggleAdmin(){
 const box=$("adminBox");
 if(box.style.display==="block"){
   box.style.display="none";
 } else {
   if(prompt("PIN")==PIN){
     box.style.display="block";
   }
 }
}

async function updateRate(){
 $("rateBox").innerHTML="–û–Ω–æ–≤–ª–µ–Ω–Ω—è...";
 try{
  const r=await fetch("https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json");
  const j=await r.json();
  usd=j[0].rate;
  $("rateBox").innerHTML="USD: "+usd.toFixed(2);
  calc();
 }catch{
  $("rateBox").innerHTML="–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è";
 }
}

[
"price","area","fam","down","years","rateSel","bankCap",
"baseM2","coef","extraPct","minDown","programLimit"
].forEach(id=>{
 $(id).addEventListener("input",calc);
});

function annuityPayment(sum, rate, months){
 const r=rate/100/12;
 return sum*(r*Math.pow(1+r,months))/(Math.pow(1+r,months)-1);
}

function remainingBalance(sum, rate, monthsPaid, totalMonths){
 const r=rate/100/12;
 const payment=annuityPayment(sum,rate,totalMonths);
 return sum*Math.pow(1+r,monthsPaid) -
        payment*((Math.pow(1+r,monthsPaid)-1)/r);
}

function calc(){

 const price=+$("price").value;
 const area=+$("area").value;
 const fam=+$("fam").value;
 const downP=+$("down").value;
 const years=+$("years").value;
 const rateBase=+$("rateSel").value;
 const cap=+$("bankCap").value;

 const base=+$("baseM2").value;
 const coef=+$("coef").value;
 const extra=+$("extraPct").value/100;
 const minDown=+$("minDown").value;
 const PROGRAM_LIMIT=+$("programLimit").value;

 const norm=fam<=2?52.5:52.5+(fam-2)*21;
 const limitM2=base*coef*(1+extra);
 const maxPrice=limitM2*norm;

 const downSum=price*downP/100;
 const loan=price-downSum;

 const totalMonths=years*12;
 const firstPeriodMonths=Math.min(120,totalMonths);

 let rateAfter = rateBase==3 ? 6 : 10;

 const payment1=annuityPayment(loan,rateBase,totalMonths);
 const balanceAfter10=remainingBalance(loan,rateBase,firstPeriodMonths,totalMonths);

 let payment2=0;
 if(totalMonths>120){
   const remainingMonths=totalMonths-120;
   payment2=annuityPayment(balanceAfter10,rateAfter,remainingMonths);
 }

 let reasons=[];
 let advice="";

 if(loan>cap || loan>PROGRAM_LIMIT){
   const maxLoan=Math.min(cap,PROGRAM_LIMIT);
   const neededDown=price-maxLoan;
   if(neededDown>downSum){
     const add=neededDown-downSum;
     advice=`–©–æ–± –ø—Ä–æ–π—Ç–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ –≤–Ω–µ—Å–æ–∫ –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ ${fmt(add)} –≥—Ä–Ω.`;
   }
 }

 if(area>norm) reasons.push("–ü–ª–æ—â–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –Ω–æ—Ä–º–∞—Ç–∏–≤.");
 if(price>maxPrice) reasons.push("–¶—ñ–Ω–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –¥–æ–ø—É—Å—Ç–∏–º—É –ø–æ —Ñ–æ—Ä–º—É–ª—ñ.");
 if(price>PROGRAM_LIMIT) reasons.push("–¶—ñ–Ω–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç –ø—Ä–æ–≥—Ä–∞–º–∏.");
 if(loan>PROGRAM_LIMIT) reasons.push("–ö—Ä–µ–¥–∏—Ç –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç –ø—Ä–æ–≥—Ä–∞–º–∏.");
 if(loan>cap) reasons.push("–ë–∞–Ω–∫ –Ω–µ –≤–∏–¥–∞—î —Ç–∞–∫—É —Å—É–º—É.");
 if(downP<minDown) reasons.push("–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ –º–µ–Ω—à–∏–π –∑–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π.");

 const fit=reasons.length===0;

 $("priceVal").innerHTML=fmt(price);
 $("areaVal").innerHTML=area+" –º¬≤";
 $("famVal").innerHTML=fam;
 $("downVal").innerHTML=downP+"%";
 $("yearsVal").innerHTML=years+" —Ä–æ–∫—ñ–≤";
 $("capVal").innerHTML=fmt(cap);

 $("out").innerHTML=`
 <div class="status ${fit?'success':'error'}">
 ${fit?'‚úÖ –ö–ª—ñ—î–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å':'‚ùå –ö–ª—ñ—î–Ω—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å'}
 </div>

 –¶—ñ–Ω–∞: ${fmt(price)} –≥—Ä–Ω (~$${fmt((price/usd).toFixed(0))})<br>
 –ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫: <strong>${downP}%</strong> (${fmt(downSum)} –≥—Ä–Ω)<br>
 –°—É–º–∞ –∫—Ä–µ–¥–∏—Ç—É: ${fmt(loan)} –≥—Ä–Ω<br><br>

 <strong>–ü–ª–∞—Ç—ñ–∂ –ø–µ—Ä—à—ñ 10 —Ä–æ–∫—ñ–≤:</strong> ${fmt(payment1.toFixed(0))} –≥—Ä–Ω<br>
 ${totalMonths>120?`
 <strong>–ü–ª–∞—Ç—ñ–∂ –∑ 11-–≥–æ —Ä–æ–∫—É:</strong> ${fmt(payment2.toFixed(0))} –≥—Ä–Ω<br>
 `:""}
 <br>

 ${!fit?`
 <strong>–ü—Ä–∏—á–∏–Ω–∏:</strong><br>
 ${reasons.map(r=>"‚Ä¢ "+r).join("<br>")}<br><br>
 ${advice?`<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:</strong><br>${advice}`:""}
 `:""}
 `;
}

calc();
